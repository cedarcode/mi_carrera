<%= form_with(
  id: "semester-#{semester}-add-subject-form",
  model: SubjectPlan.new,
  url: subject_plans_path,
  method: :post,
  data: { turbo: true, controller: "subject-selector" },
  class: 'flex items-center border-t border-gray-100 text-sm/6'
) do |form| %>
  <%= form.select(
    :subject_id,
    grouped_options_for_select(
      not_planned_subjects.group_by(&:category).compact_blank.map do |category, subjects|
        [formatted_category(category), subjects.map { |subject| [display_planned_subject_name_and_code(subject), subject.id] }]
      end
    ),
    {},
    { data: { subject_selector_target: "select", action: "subject-selector#onChange" }, class: "invisible absolute" }
  ) %>
  <%= form.hidden_field :semester, value: semester %>
  <%= render ButtonComponent.new(form: form, label: "AÃ±adir") %>
<% end %>
