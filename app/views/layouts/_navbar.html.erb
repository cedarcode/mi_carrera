<header class="fixed top-0 w-full bg-primary text-white z-4" data-controller='search'>
  <% show_search_bar = params[:search].present? %>

  <div class="flex border-box w-full h-16 <%= show_search_bar ? 'hidden' : '' %>" data-search-target="appBar">
    <div class="flex items-center gap-4 ms-4">
      <%= button_tag type: "button", class: "size-6 cursor-pointer", data: { action: "click->navigation-drawer#toggle" } do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
        </svg>
      <% end %>

      <%= link_to 'MiCarrera', root_path, class: 'text-xl font-bold' %>
    </div>

    <div class="flex w-full justify-end items-center me-4">
      <%= button_tag type: "button", class: "me-3 cursor-pointer", data: { action: "search#toggle" } do %>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
        </svg>
      <% end %>

      <%= button_tag type: "button", class: "me-3 cursor-pointer", id: "butInstall" do %>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
          <path fill-rule="evenodd" d="M10.5 3.75a6 6 0 0 0-5.98 6.496A5.25 5.25 0 0 0 6.75 20.25H18a4.5 4.5 0 0 0 2.206-8.423 3.75 3.75 0 0 0-4.133-4.303A6.001 6.001 0 0 0 10.5 3.75Zm2.25 6a.75.75 0 0 0-1.5 0v4.94l-1.72-1.72a.75.75 0 0 0-1.06 1.06l3 3a.75.75 0 0 0 1.06 0l3-3a.75.75 0 1 0-1.06-1.06l-1.72 1.72V9.75Z" clip-rule="evenodd" />
        </svg>
      <% end %>

      <%= yield :credits %>

      <div class="relative mx-3" data-controller='user-menu' data-action="click@document->user-menu#onClick">
        <%= button_tag type: "button", id: "user-menu", class: "flex cursor-pointer", data: { user_menu_target: 'trigger', action: 'click->user-menu#toggle:stop' } do %>
          <% if current_user %>
            <div class="flex items-center justify-center size-6 rounded-full bg-sky-500">
              <%= current_user.email.first.capitalize %>
            </div>
          <% else %>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" class="size-6">
              <path
                fill-rule="evenodd"
                d="M18.685 19.097A9.723 9.723 0 0 0 21.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 0 0 3.065 7.097A9.716 9.716 0 0 0 12 21.75a9.716 9.716 0 0 0 6.685-2.653Zm-12.54-1.285A7.486 7.486 0 0 1 12 15a7.486 7.486 0 0 1 5.855 2.812A8.224 8.224 0 0 1 12 20.25a8.224 8.224 0 0 1-5.855-2.438ZM15.75 9a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"
                clip-rule="evenodd"
              />
            </svg>
          <% end %>
        <% end %>

        <%= render 'shared/user_menu' %>
      </div>
    </div>
  </div>

  <div id="searchbar" class="mdc-top-app-bar__row <%= show_search_bar ? '' : 'd-none' %>" data-search-target="searchbar">
    <%= form_with(url: all_subjects_path, method: :get, local: true) do |f| %>
      <div class="mdc-text-field mdc-text-field--filled mdc-text-field--label-floating mdc-text-field--no-label mdc-text-field--with-trailing-icon">
        <span class="mdc-text-field__ripple"></span>
        <%= f.text_field :search, value: params[:search], class: "mdc-text-field__input", placeholder: "Buscar por nombre o cÃ³digo de la materia", autofocus: true, data: { 'search-target': "searchInput" } %>
        <i class="material-icons mdc-text-field__icon mdc-text-field__icon--trailing" data-action="click->search#toggle" tabindex="0" role="button">close</i>
        <span class="mdc-line-ripple"></span>
      </div>
    <% end %>
  </div>
</header>
